#!/bin/bash

# REQUIRED

source ~/ccktools/.ccktools_aliases

# FUNCTIONS

goto() {
	if [[ $1 ]]; then
		cd /mnt/c/vhost/$1*
	else
		cd /mnt/c/vhost
	fi
}

gosi() {
	if [[ $1 ]]; then
		cd /mnt/c/wsl/sites/$1*
		cd docroot 2>/dev/null
		cd web 2>/dev/null
	else
		cd /mnt/c/wsl/sites
	fi
}

goth() {
	if [[ $1 ]]; then
		cd /mnt/c/wsl/sites/$1*
		cd docroot/themes/custom/
	else
		cd /mnt/c/wsl/sites
	fi
}

phpchanger() {
	echo "
_________________________
==> disabling mods"
	sudo a2dismod php5.6
	sudo a2dismod php7.0
	sudo a2dismod php7.1
	sudo a2dismod php7.2
	echo "
_________________________
==> disabling mpm"
	sudo a2dismod mpm_prefork
	sudo a2dismod mpm_worker
	sudo a2dismod mpm_event
	sudo a2dismod mpm_prefork
	echo "
_________________________
==> enabling $1"
	sudo a2enmod php$1
	sudo update-alternatives --set php /usr/bin/php$1
	echo "
_________________________
==> restarting apache"
	sudo service apache2 restart
	php -v
}

crequire() {
	if [[ $@ ]]; then
		for var in "$@"; do
			echo "-> ${var}"
			composer require drupal/${var} --no-update
		done
		composer update --with-dependencies
	else
		echo "falta nombre"
	fi
}

cremove() {
	if [[ $@ ]]; then
		for var in "$@"; do
			echo "-> ${var}"
			drush pmu -y ${var}
			composer remove drupal/${var}
		done
		composer update --with-dependencies
	else
		echo "falta nombre"
	fi
}

cr-update-core() {
	composer outdated "drupal/*"
	composer update drupal/core --with-dependencies
	drush updatedb
	drush cr
}

cr-update() {
	composer update --with-dependencies
	drush updatedb
	drush cr
}

superchargephp() {
	sudo find /etc/php/ -name php.ini
	sudo find /etc/php/ -name php.ini -exec sed -i 's/post_max_size = 8M/post_max_size = 8G/g' {} \;
	sudo find /etc/php/ -name php.ini -exec sed -i 's/upload_max_filesize = 2M/upload_max_filesize = 2G/g' {} \;
	sudo find /etc/php/ -name php.ini -exec sed -i 's/memory_limit = 128M/memory_limit = 2G/g' {} \;
	sudo find /etc/php/ -name php.ini -exec sed -i 's/max_execution_time = 30/max_execution_time = 300 #/g' {} \;
	sudo find /etc/php/ -name php.ini -exec sed -i 's/max_input_time = 60/max_input_time = 600 #/g' {} \;
	sudo find /etc/php/ -name php.ini -exec sed -i 's/;date.timezone =/date.timezone = Europe\/Madrid/g' {} \;

	echo Hecho
}

updatebuntu() {
	echo "actualizando lista de paquetes..."
	sudo apt -qq update
	echo "actualizando paquetes..."
	sudo apt -qq upgrade -y
	echo "actualizando php..."
	superchargephp
	echo "limpiando..."
	sudo apt -qq autoremove -y
	sudo apt -qq autoclean -y
	sudo apt -qq clean -y
}

drsinew() {
	SITE=${1}
	drush -yv si standard --db-url=mysql://root:root@localhost/${SITE} --site-name=${SITE} --site-mail=test@${SITE}.test --account-name=admin --account-mail=test@${SITE}.test --account-pass=admin --locale=es
}

open_browsers() {
	/mnt/c/Program\ Files/Mozilla\ Firefox/firefox.exe $1
	/mnt/c/Program\ Files/internet\ explorer/iexplore.exe $1
	/mnt/c/Program\ Files\ \(x86\)/BraveSoftware/Brave-Browser/Application/brave.exe $1
}

ssh_laucher() {
	SERVICE="ssh-agent"
	if pgrep -x "$SERVICE"; then
		echo "$SERVICE is running yet"
	else
		echo "starting $SERVICE"
		sudo chmod 700 $HOME/.ssh
		sudo chmod 600 $HOME/.ssh/*
		sudo chmod 600 $HOME/.ssh/*.pub
		eval $(ssh-agent -s)
		ssh-add -q $HOME/.ssh/id_rsa_c*

	fi
}

lamp_laucher() {
	SERVICE="apache2"
	if pgrep -x "$SERVICE"; then
		echo "$SERVICE is running yet"
	else
		echo "starting $SERVICE"
		lamp start
	fi
}

