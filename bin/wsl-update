#!/bin/bash

wsl_stop() {
  echo "
  ==> la consola va a cerrarse
  "
  # read a
  sleep 1
  sudo killall -r '.*'
}

wsl_update() {
  cd ~/ccktools/
  git reset --hard
  git pull origin master
  find ~/ccktools/bin -type f -exec chmod +x {} \;
  find ~/ccktools/bin -type f -exec dos2unix {} \;
}

cd ~/ccktools/
echo "==> Checking ccktools updates..." &
git fetch &>/dev/null

UPSTREAM=${1:-'@{u}'}
LOCAL=$(git rev-parse @) &
REMOTE=$(git rev-parse "$UPSTREAM") &
BASE=$(git merge-base @ "$UPSTREAM")

if [ $LOCAL = $REMOTE ]; then
  clear
  exit
elif [ $LOCAL = $BASE ]; then
  echo "==> Updating ccktools..."
  wsl_update
elif [ $REMOTE = $BASE ]; then
  echo "==>Need to push"
else
  echo "==>Diverged"
fi
